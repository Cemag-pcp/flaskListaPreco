{% extends "layout.html" %}
{% block body %}

<style>
    /* Estilos para dispositivos móveis */
    @media only screen and (max-width: 600px) {
    .responsive-table {
        max-width: 100%;
        overflow-x: auto;
    }

    .responsive-table thead {
        display: none;
    }
    
    .responsive-table td,
    .responsive-table th {
        display: block;
        text-align: center;
    }
    
    .responsive-table td:before {
        content: attr(data-label);
        font-weight: bold;
        display: block;
        margin-bottom: 5px;
    }
    }

    .filter-wrapper {
    display: flex;
    flex-direction: row;
    align-items: center;
    }

    .filter-wrapper div {
        margin-right: 10px;
    }
</style>

<style>
    .selected {
      background-color: rgb(139, 208, 97); /* Altere para a cor desejada */
    }
</style>

<div class="filter-wrapper">

    <div>
      <label for="descricao_generica">descricao_generica:</label>
      <select type="text" id="descricao_generica" sdata-live-search="true" onchange="filtrarTabela()">
          <option value="">Todos</option>
          {% for data in descricao_generica_unique %}
              <option value="{{ data }}">{{ data }}</option>
          {% endfor %}
      </select>
    </div>

    <div>
      <label for="modelo">modelo:</label>
      <select type="text" id="modelo" sdata-live-search="true" onchange="filtrarTabela()">
          <option value="">Todos</option>
          {% for data in modelo_unique %}
              <option value="{{ data }}">{{ data }}</option>
          {% endfor %}
      </select>
    </div>

    <div>
      <label for="eixo">eixo:</label>
      <select type="text" id="eixo" sdata-live-search="true" onchange="filtrarTabela()">
          <option value="">Todos</option>
          {% for data in eixo_unique %}
              <option value="{{ data }}">{{ data }}</option>
          {% endfor %}
      </select>
    </div>

    <div>
      <label for="mola_freio">mola_freio:</label>
      <select type="text" id="mola_freio" sdata-live-search="true" onchange="filtrarTabela()">
          <option value="">Todos</option>
          {% for data in mola_freio_unique %}
              <option value="{{ data }}">{{ data }}</option>
          {% endfor %}
      </select>  
    </div>

    <div>
      <label for="tamanho">tamanho:</label>
      <select type="text" id="tamanho" sdata-live-search="true" onchange="filtrarTabela()">
          <option value="">Todos</option>
          {% for data in tamanho_unique %}
              <option value="{{ data }}">{{ data }}</option>
          {% endfor %}
      </select>  
    </div>

    <div>
      <label for="rodado">rodado:</label>
      <select type="text" id="rodado" sdata-live-search="true" onchange="filtrarTabela()">
          <option value="">Todos</option>
          {% for data in rodado_unique %}
              <option value="{{ data }}">{{ data }}</option>
          {% endfor %}
      </select>  
    </div>

    <div>
      <label for="pneu">pneu:</label>
      <select type="text" id="pneu" sdata-live-search="true" onchange="filtrarTabela()">
          <option value="">Todos</option>
          {% for data in pneu_unique %}
              <option value="{{ data }}">{{ data }}</option>
          {% endfor %}
      </select>  
    </div>

    <div>
      <label for="adicionais">adicionais:</label>
      <select type="text" id="adicionais" sdata-live-search="true" onchange="filtrarTabela()">
          <option value="">Todos</option>
          {% for data in adicionais_unique %}
              <option value="{{ data }}">{{ data }}</option>
          {% endfor %}
      </select>  
    </div>

    <button onclick="enviarDados()">Enviar Dados Selecionados</button>
    <button onclick="selecionarTodos()">Apagar filtros</button>


</div>

<div class="container pt-4">
    <h2>Lista de preços</h2>
    <div class="row">
        <div style="position: relative;">
            <a href="/export/pdf-all">
                <i class="fas fa-file-pdf" style="font-size:20px;color:red"></i>
            </a>
            <table id="table3" class="table table-striped responsive-table">
              <thead>
                  <tr>
                      <th>Código</th>
                  </tr>
              </thead>
              <tbody>
                  {% for row in data %}
                  <tr>
                    <td>{{row.codigo}}</td>
                  </tr>
                  {% endfor %}
                </tbody>
            </table>  
        </div>
    </div>
</div>

<div id="loading-overlay" style="display: none;">
  <div id="loading-spinner"></div>
</div>

<style>
  /* Estilos para o indicador de carregamento */
  #loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
  }
  
  #loading-spinner {
      width: 50px;
      height: 50px;
      border: 3px solid #fff;
      border-top: 3px solid #f00;
      border-radius: 50%;
      animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }
</style>

<script>
  function selecionarTodos() {
    var descricaoGenericaSelect = document.getElementById('descricao_generica')
    var modeloSelect = document.getElementById('modelo');
    var eixoSelect = document.getElementById('eixo');
    var molaFreioSelect = document.getElementById('mola_freio');
    var tamanhoSelect = document.getElementById('tamanho');
    var rodadoSelect = document.getElementById('rodado');
    var pneuSelect = document.getElementById('pneu');
    var adicionaisSelect = document.getElementById('adicionais');

    // Defina o valor "Todos" para cada dropdown
    descricaoGenericaSelect.value = 'Todos';
    modeloSelect.value = 'Todos';
    eixoSelect.value = 'Todos';
    molaFreioSelect.value = 'Todos';
    tamanhoSelect.value = 'Todos';
    rodadoSelect.value = 'Todos';
    pneuSelect.value = 'Todos';
    adicionaisSelect.value = 'Todos';

    // Dispare o evento "onchange" para acionar a ação desejada
    descricaoGenericaSelect.onchange();
    modeloSelect.onchange();
    eixoSelect.onchange();
    molaFreioSelect.onchange();
    tamanhoSelect.onchange();
    rodadoSelect.onchange();
    pneuSelect.onchange();
    adicionaisSelect.onchange();
  }
</script>

<script>
  function filtrarTabela() {
    $("#loading-overlay").show();

    var descricaoGenericaSelect = document.getElementById('descricao_generica');
    var modeloSelect = document.getElementById('modelo');
    var eixoSelect = document.getElementById('eixo');
    var molaFreioSelect = document.getElementById('mola_freio');
    var tamanhoSelect = document.getElementById('tamanho');
    var rodadoSelect = document.getElementById('rodado');
    var pneuSelect = document.getElementById('pneu');
    var adicionaisSelect = document.getElementById('adicionais');
    
    var descricaoGenerica = descricaoGenericaSelect.value;
    var modelo = modeloSelect.value;
    var eixo = eixoSelect.value;
    var molaFreio = molaFreioSelect.value;
    var tamanho = tamanhoSelect.value;
    var rodado = rodadoSelect.value;
    var pneu = pneuSelect.value;
    var adicionais = adicionaisSelect.value;

    $.ajax({
        url: '/filtros',
        type: 'GET',
        data: {
            descricao_generica: descricaoGenerica,
            modelo: modelo,
            eixo: eixo,
            mola_freio: molaFreio,
            tamanho: tamanho,
            rodado: rodado,
            pneu: pneu,
            adicionais: adicionais
        },
        success: function(data) {
          // Armazena o valor atual selecionado nos seletores
          var descricaoGenericaSelectedValue = descricaoGenericaSelect.value;
          var modeloSelectedValue = modeloSelect.value;
          var eixoSelectedValue = eixoSelect.value;
          var molaFreioSelectedValue = molaFreioSelect.value;
          var tamanhoSelectedValue = tamanhoSelect.value;
          var rodadoSelectedValue = rodadoSelect.value;
          var pneuSelectedValue = pneuSelect.value;
          var adicionaisSelectedValue = adicionaisSelect.value;

          // Limpa os dropdowns
          descricaoGenericaSelect.innerHTML = '<option value="">Todos</option>';          
          modeloSelect.innerHTML = '<option value="">Todos</option>';
          eixoSelect.innerHTML = '<option value="">Todos</option>';
          molaFreioSelect.innerHTML = '<option value="">Todos</option>';
          tamanhoSelect.innerHTML = '<option value="">Todos</option>';
          rodadoSelect.innerHTML = '<option value="">Todos</option>';
          pneuSelect.innerHTML = '<option value="">Todos</option>';
          adicionaisSelect.innerHTML = '<option value="">Todos</option>';

          // Atualiza os dropdowns com as opções retornadas do servidor
          for (var i = 0; i < data.descricao_generica_unique.length; i++) {
              var option = document.createElement('option');
              option.text = data.descricao_generica_unique[i];
              option.value = data.descricao_generica_unique[i];
              descricaoGenericaSelect.add(option);
          }

          for (var i = 0; i < data.modelo_unique.length; i++) {
              var option = document.createElement('option');
              option.text = data.modelo_unique[i];
              option.value = data.modelo_unique[i];
              modeloSelect.add(option);
          }

          for (var i = 0; i < data.eixo_unique.length; i++) {
              var option = document.createElement('option');
              option.text = data.eixo_unique[i];
              option.value = data.eixo_unique[i];
              eixoSelect.add(option);
          }

          for (var i = 0; i < data.mola_freio_unique.length; i++) {
              var option = document.createElement('option');
              option.text = data.mola_freio_unique[i];
              option.value = data.mola_freio_unique[i];
              molaFreioSelect.add(option);
          }

          for (var i = 0; i < data.tamanho_unique.length; i++) {
              var option = document.createElement('option');
              option.text = data.tamanho_unique[i];
              option.value = data.tamanho_unique[i];
              tamanhoSelect.add(option);
          }

          for (var i = 0; i < data.rodado_unique.length; i++) {
              var option = document.createElement('option');
              option.text = data.rodado_unique[i];
              option.value = data.rodado_unique[i];
              rodadoSelect.add(option);
          }

          for (var i = 0; i < data.pneu_unique.length; i++) {
              var option = document.createElement('option');
              option.text = data.pneu_unique[i];
              option.value = data.pneu_unique[i];
              pneuSelect.add(option);
          }

          for (var i = 0; i < data.adicionais_unique.length; i++) {
              var option = document.createElement('option');
              option.text = data.adicionais_unique[i];
              option.value = data.adicionais_unique[i];
              adicionaisSelect.add(option);
          }

          // Define o valor selecionado novamente nos seletores
          descricaoGenericaSelect.value = descricaoGenericaSelectedValue
          modeloSelect.value = modeloSelectedValue;
          eixoSelect.value = eixoSelectedValue;
          molaFreioSelect.value = molaFreioSelectedValue;
          tamanhoSelect.value = tamanhoSelectedValue;
          rodadoSelect.value = rodadoSelectedValue;
          pneuSelect.value = pneuSelectedValue;
          adicionaisSelect.value = adicionaisSelectedValue;

          // Atualiza a tabela com a nova tabela
          var tbody = document.getElementById("table3").getElementsByTagName("tbody")[0];
          tbody.innerHTML = "";

          for (var i = 0; i < data.tabela_nova.length; i++) {
              var row = data.tabela_nova[i];
              var newRow = tbody.insertRow();

              for (var j = 0; j < row.length; j++) {
                  var cell = newRow.insertCell(j);
                  cell.innerHTML = row[j];
              }
          }

          // Oculta o indicador de carregamento
          $("#loading-overlay").hide();

      }

    });
  }
</script>

<script>
    function toggleCheckbox(row) {
      var checkbox = row.querySelector('input[type="checkbox"]');
      checkbox.checked = !checkbox.checked;
      toggleRowColor(checkbox);
    }
  
    function toggleRowColor(checkbox) {
      var row = checkbox.parentNode.parentNode;
      if (checkbox.checked) {
        row.classList.add("selected");
      } else {
        row.classList.remove("selected");
      }
    }
</script>

<!-- <script>
    function filtrarTabela() {
      var inputFamilia = document.getElementById("filtro-familia").value.toUpperCase();
      var inputCodigo = document.getElementById("filtro-codigo").value.toUpperCase();
      var inputDescricao = document.getElementById("filtro-descricao").value.toUpperCase();

      var tabela = document.getElementById("table1");
      var linhas = tabela.getElementsByTagName("tr");
    
      for (var i = 0; i < linhas.length; i++) {
        var colunaFamilia = linhas[i].getElementsByTagName("td")[0];
        var colunaCodigo = linhas[i].getElementsByTagName("td")[1];
        var colunaDescricao = linhas[i].getElementsByTagName("td")[2];

        if (colunaFamilia && colunaCodigo) {
          var textoFamilia = colunaFamilia.textContent || colunaFamilia.innerText;
          var textoCodigo = colunaCodigo.textContent || colunaCodigo.innerText;
          var textoDescricao = colunaDescricao.textContent || colunaDescricao.innerText;

          if (
            textoFamilia.toUpperCase().indexOf(inputFamilia) > -1 &&
            textoCodigo.toUpperCase().indexOf(inputCodigo) > -1 &&
            textoDescricao.toUpperCase().indexOf(inputDescricao) > -1
          ) {
            linhas[i].style.display = "";
          } else {
            linhas[i].style.display = "none";
          }
        }
      }
    }
</script> -->

<script>

    function enviarDados() {
        var checkboxes = document.querySelectorAll('input[name="item[]"]:checked');
        var dadosSelecionados = [];
    
        for (var i = 0; i < checkboxes.length; i++) {
        dadosSelecionados.push(checkboxes[i].value);
        }
    
        // Enviar os dados selecionados para o backend via AJAX
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/checkbox', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function() {
        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
            console.log('Dados enviados com sucesso!');
        }
        };
        xhr.send(JSON.stringify(dadosSelecionados));
    }

</script>


{% endblock %}